<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Card Navi - ì¹´ë“œ ì¶”ì²œ ì‹œìŠ¤í…œ</title>
    <style>
        /* === (ì›ë³¸ ìŠ¤íƒ€ì¼ ìœ ì§€) === */
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', sans-serif;
               background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); min-height:100vh; color:#333; }
        .container{ max-width:1200px; margin:0 auto; padding:2rem; }
        .header{ text-align:center; margin-bottom:3rem; animation:fadeInDown .8s ease-out; }
        .logo{ font-size:3.5rem; font-weight:700; color:white; text-shadow:0 4px 8px rgba(0,0,0,.3); margin-bottom:1rem; letter-spacing:-2px;}
        .subtitle{ color: rgba(255,255,255,.9); font-size:1.2rem; font-weight:300; }

        .main-card{ background:rgba(255,255,255,.95); border-radius:20px; padding:3rem; box-shadow:0 20px 40px rgba(0,0,0,.1);
                    backdrop-filter: blur(10px); border:1px solid rgba(255,255,255,.3); animation:fadeInUp .8s ease-out .4s both; }

        .section-title{ font-size:1.8rem; font-weight:600; color:#2c3e50; margin-bottom:2rem; text-align:center; position:relative; }
        .section-title::after{ content:''; position:absolute; bottom:-10px; left:50%; transform:translateX(-50%); width:60px; height:3px;
                               background:linear-gradient(90deg,#667eea,#764ba2); border-radius:2px; }

        .selection-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:2rem; margin-bottom:2rem; }
        .selection-item{ background:linear-gradient(135deg,#f8f9fa 0%,#e9ecef 100%); padding:1.5rem; border-radius:15px; border-left:4px solid #667eea;
                         transition:all .3s ease; }
        .selection-item:hover{ transform:translateY(-5px); box-shadow:0 10px 30px rgba(0,0,0,.15); border-left-color:#764ba2; }

        .selection-label{ font-weight:600; color:#495057; font-size:1rem; margin-bottom:1rem; display:flex; align-items:center; }
        .selection-badge{ background:linear-gradient(45deg,#667eea,#764ba2); color:white; padding:.3rem .8rem; border-radius:20px;
                          font-size:.8rem; font-weight:500; margin-left:.5rem; }

        select{ width:100%; padding:1rem; border:2px solid #e9ecef; border-radius:12px; font-size:1rem; font-weight:600; color:#2c3e50; background:white; cursor:pointer; transition:all .3s ease; }
        select:hover{ border-color:#667eea; background:#f8f9ff; }
        select:focus{ outline:none; border-color:#667eea; box-shadow:0 0 0 3px rgba(102,126,234,.1); }

        .search-section{ text-align:center; margin:2rem 0; }
        .search-button{ background:linear-gradient(135deg,#667eea,#764ba2); color:white; border:none; padding:1rem 3rem; font-size:1.1rem; font-weight:600; border-radius:50px; cursor:pointer; transition:all .3s ease; box-shadow:0 4px 15px rgba(102,126,234,.3); }
        .search-button:hover{ transform:translateY(-2px); box-shadow:0 8px 25px rgba(102,126,234,.4); }
        .search-button:active{ transform:translateY(0); }

        .dynamic-content{ margin-top:2rem; animation:fadeInUp .5s ease-out; }
        .results-card{ background:linear-gradient(135deg,#f8f9fa,#ffffff); border-radius:15px; padding:2rem; margin-bottom:2rem; box-shadow:0 8px 25px rgba(0,0,0,.1); border:1px solid rgba(102,126,234,.2); }
        .category-title{ font-size:1.4rem; font-weight:600; color:#2c3e50; margin-bottom:1.5rem; padding-bottom:.5rem; border-bottom:2px solid #667eea; display:inline-block; }

        .checkbox-group{ display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:.8rem; margin-bottom:2rem; }
        .checkbox-group label{ display:flex; align-items:center; padding:.8rem; background:white; border-radius:10px; border:2px solid #e9ecef; transition:all .3s ease; cursor:pointer; position:relative; overflow:hidden; }
        .checkbox-group label::before{ content:''; position:absolute; top:0; left:-100%; width:100%; height:100%; background:linear-gradient(90deg,transparent, rgba(102,126,234,.1),transparent); transition:left .5s; }
        .checkbox-group label:hover::before{ left:100%; }
        .checkbox-group label:hover{ border-color:#667eea; background:#f8f9ff; transform:translateY(-2px); }
        .checkbox-group input[type="checkbox"]{ width:18px; height:18px; margin-right:.8rem; accent-color:#667eea; cursor:pointer; }
        .checkbox-group input[type="checkbox"]:checked + span{ color:#667eea; font-weight:600; }

        .subcategory-group{ background:rgba(102,126,234,.05); border-radius:12px; padding:1.5rem; margin-bottom:1.5rem; border-left:4px solid #667eea; }
        .subcategory-title{ font-size:1.1rem; font-weight:600; color:#667eea; margin-bottom:1rem; display:flex; align-items:center; }
        .subcategory-title::before{ content:'ğŸ“‚'; margin-right:.5rem; }
        .subcategory-items{ display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:.5rem; }
        .subcategory-items label{ padding:.6rem; font-size:.9rem; }

        .action-button{ background:linear-gradient(135deg,#28a745,#20c997); color:white; border:none; padding:.8rem 2rem; font-size:1rem; font-weight:600; border-radius:25px; cursor:pointer; transition:all .3s ease; margin:1rem 0; box-shadow:0 4px 15px rgba(40,167,69,.3); }
        .action-button:hover{ transform:translateY(-2px); box-shadow:0 8px 25px rgba(40,167,69,.4); }

        .card-result { display:flex; gap:16px; align-items:flex-start; padding:12px; border-radius:10px; background:#fff; border:1px solid #eee; margin-bottom:12px; }
        .card-result img{ width:140px; height:auto; object-fit:contain; border-radius:6px; }

        @keyframes fadeInDown{ from{ opacity:0; transform:translateY(-30px);} to{ opacity:1; transform:translateY(0);} }
        @keyframes fadeInUp{ from{ opacity:0; transform:translateY(30px);} to{ opacity:1; transform:translateY(0);} }

        @media (max-width:768px){
            .selection-grid{ grid-template-columns:1fr; }
            .checkbox-group{ grid-template-columns:1fr; }
        }
    </style>
</head>
<body>
    <!-- floating particles (ì›ë³¸) -->
    <div class="particle" style="width:8px;height:8px;top:20%;left:10%;animation-delay:0s;"></div>
    <div class="particle" style="width:6px;height:6px;top:60%;left:90%;animation-delay:2s;"></div>
    <div class="particle" style="width:10px;height:10px;top:80%;left:20%;animation-delay:4s;"></div>

    <div class="container">
        <header class="header">
            <h1 class="logo">Card Navi</h1>
            <p class="subtitle">ë§ì¶¤í˜• ì¹´ë“œ ì¶”ì²œ ì‹œìŠ¤í…œ</p>
        </header>

        <main class="main-card">
            <h2 class="section-title">ì§€ì—­êµ¬, ì„±ë³„, ì—°ë ¹ëŒ€ ì„ íƒ í›„ ê²€ìƒ‰ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”</h2>

            <div class="selection-grid">
                <div class="selection-item">
                    <div class="selection-label">ì§€ì—­êµ¬ ì„ íƒ <span class="selection-badge">ğŸ¯</span></div>
                    <select id="region">
                        <option value="Gwan">ê¶Œì„ êµ¬</option>
                        <option value="Young">ì˜í†µêµ¬</option>
                        <option value="Jang">ì¥ì•ˆêµ¬</option>
                        <option value="Pal">íŒ”ë‹¬êµ¬</option>
                    </select>
                </div>

                <div class="selection-item">
                    <div class="selection-label">ì„±ë³„ ì„ íƒ <span class="selection-badge">ğŸ‘¤</span></div>
                    <select id="sex">
                        <option value="M">ë‚¨ì„±</option>
                        <option value="F">ì—¬ì„±</option>
                    </select>
                </div>

                <div class="selection-item">
                    <div class="selection-label">ì—°ë ¹ ì„ íƒ <span class="selection-badge">ğŸ¯</span></div>
                    <select id="age">
                        <option value="20s">20ëŒ€</option>
                        <option value="30s">30ëŒ€</option>
                        <option value="40s">40ëŒ€</option>
                        <option value="50s">50ëŒ€</option>
                        <option value="60s">60ëŒ€</option>
                        <option value="70s">70ëŒ€</option>
                        <option value="80s">80ëŒ€</option>
                        <option value="90s">90ëŒ€</option>
                    </select>
                </div>
            </div>

            <div class="search-section">
                <button class="search-button" onclick="showOptions()">ğŸ” ê²€ìƒ‰í•˜ê¸°</button>
            </div>

            <!-- ê²°ê³¼: ì¶”ì²œ ëŒ€ë¶„ë¥˜ / ì „ì²´ ëŒ€ë¶„ë¥˜ / ì†Œë¶„ë¥˜ / ì¹´ë“œë¦¬ìŠ¤íŠ¸ê°€ ëª¨ë‘ ì´ ì•ˆì— ê·¸ë ¤ì§‘ë‹ˆë‹¤ -->
            <div id="resultContainer" class="dynamic-content"></div>
        </main>
    </div>

    <!-- PapaParse (CSV íŒŒì‹±) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <script>
    // === ë°ì´í„°/ë§µ ì´ˆê¸°í™” ===
    const subCategoryMap = {
        "ê³µì—°/ì „ì‹œ": ["ê³µì—°ê´€ëŒ", "ë¬¸í™”ì„œë¹„ìŠ¤", "ì „ì‹œì¥", "ê²½ê¸°ê´€ëŒ"],
        "ë””ì €íŠ¸": ["ì œê³¼/ì œë¹µ/ë–¡/ì¼€ìµ", "ì»¤í”¼/ìŒë£Œ"],
        "ìƒí™œì„œë¹„ìŠ¤": ["ë¯¸ìš©ì„œë¹„ìŠ¤", "ì„¸íƒ/ê°€ì‚¬ì„œë¹„ìŠ¤", "ì—°ë£ŒíŒë§¤", "ì°¨ëŸ‰ê´€ë¦¬/ì„œë¹„ìŠ¤", "ë³´ì•ˆ/ìš´ì†¡", "ë¬´ì í¬ì„œë¹„ìŠ¤", "ì‚¬ìš°ë‚˜/íœ´ê²Œì‹œì„¤", "ìˆ˜ë¦¬ì„œë¹„ìŠ¤", "ë Œíƒˆì„œë¹„ìŠ¤", "êµí†µì„œë¹„ìŠ¤", "ì „ë¬¸ì„œë¹„ìŠ¤", "ì—¬í–‰/ìœ í•™ëŒ€í–‰", "ë¶€ë™ì‚°"],
        "ì†Œë§¤/ìœ í†µ": ["ê±´ê°•/ê¸°í˜¸ì‹í’ˆ", "ì‚¬ë¬´/êµìœ¡ìš©í’ˆ", "ì„œì /ë„ì„œ", "ì„ ë¬¼/ì™„êµ¬", "ìŠ¤í¬ì¸ /ë ˆì ¸ìš©í’ˆ", "ìŒ/ì‹ë£Œí’ˆì†Œë§¤", "ì˜ë³µ/ì˜ë¥˜", "ì¸í…Œë¦¬ì–´/ê°€ì •ìš©í’ˆ", "ì¢…í•©ì†Œë§¤ì ", "ì°¨ëŸ‰ê´€ë¦¬/ë¶€í’ˆ", "ì•…ê¸°/ê³µì˜ˆ", "íŒ¨ì…˜ì¡í™”", "í™”ì¥í’ˆì†Œë§¤", "ì°¨ëŸ‰íŒë§¤", "ê°€ì „ì œí’ˆ", "ìœ ì•„ìš©í’ˆ"],
        "ì‹ì‚¬": ["ê³ ê¸°ìš”ë¦¬", "ë‹­/ì˜¤ë¦¬ìš”ë¦¬", "ë³„ì‹/í“¨ì „ìš”ë¦¬", "ë¶€í˜", "ë¶„ì‹", "ì–‘ì‹", "ì¼ì‹/ìˆ˜ì‚°ë¬¼", "ì¤‘ì‹", "íŒ¨ìŠ¤íŠ¸í‘¸ë“œ", "í•œì‹", "íœ´ê²Œì†Œ/ëŒ€í˜•ì—…ì²´"],
        "ì—¬ê°€/ì˜¤ë½": ["ìˆ™ë°•", "ì¼ë°˜ìŠ¤í¬ì¸ ", "ì·¨ë¯¸/ì˜¤ë½", "ìš”ê°€/ë‹¨ì „/ë§ˆì‚¬ì§€"],
        "ì˜ë£Œ/ê±´ê°•": ["ìˆ˜ì˜ì—…", "ì˜ì•½/ì˜ë£Œí’ˆ", "ì¼ë°˜ë³‘ì›", "íŠ¹í™”ë³‘ì›", "ì¢…í•©ë³‘ì›"],
        "ì „ììƒê±°ë˜": ["ì¸í„°ë„·ì‡¼í•‘", "ìŒì‹ë°°ë‹¬ì„œë¹„ìŠ¤"]
    };

    // CSVì—ì„œ ì½ì€ ì¹´ë“œ ë°ì´í„° ì €ì¥
    let cardData = [];

    // CSV ë¡œë“œ (raw github url)
    Papa.parse("https://raw.githubusercontent.com/SUNH4/Outlier_Flow/main/final_web.csv", {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
            cardData = results.data || [];
            // ë¡œë“œ ì™„ë£Œì‹œ ì½˜ì†”ë§Œ ë‚¨ê¹€ (ì›í•˜ì‹œë©´ ì œê±° ê°€ëŠ¥)
            // console.log("CSV loaded", cardData.length);
        }
    });

    /* ============= ì£¼ìš” í”Œë¡œìš° =============
       1) showOptions() : ì§€ì—­/ì„±ë³„/ì—°ë ¹ ì„ íƒ í›„ 'ê²€ìƒ‰' ëˆŒë €ì„ ë•Œ, ì¶”ì²œ ëŒ€ë¶„ë¥˜+ì „ì²´ ëŒ€ë¶„ë¥˜ ë Œë”
       2) 'ğŸ” ì†Œë¶„ë¥˜ ê²€ìƒ‰' ë²„íŠ¼ : ì²´í¬ëœ ëŒ€ë¶„ë¥˜(ì¶”ì²œ/ì „ì²´)ë¥¼ ëª¨ì•„ ì†Œë¶„ë¥˜ ëª©ë¡ ë Œë”
       3) ì†Œë¶„ë¥˜ ëª©ë¡ ì•„ë˜ 'ì¹´ë“œ ê²€ìƒ‰' ë²„íŠ¼ : í´ë¦­í•˜ë©´ CSVì—ì„œ ëŒ€ë¶„ë¥˜ OR ì†Œë¶„ë¥˜ íƒœê·¸ê°€ ì¼ì¹˜í•˜ëŠ” ì¹´ë“œ í•„í„° -> ì¶œë ¥
    =======================================*/

    function showOptions() {
        const sex = document.getElementById("sex").value;
        const age = document.getElementById("age").value;
        const region = document.getElementById("region").value;
        const resultDiv = document.getElementById("resultContainer");
        resultDiv.innerHTML = "";

        // ì¶”ì²œ ì—…ì¢… ê²°ì • (ì›ë³¸ ë¡œì§ ê·¸ëŒ€ë¡œ)
        let recommendedItems = [];
        if (region === "Gwan" && sex === "M" && age === "20s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ì˜ë£Œ/ê±´ê°•","ë””ì €íŠ¸"];
        } else if (region === "Gwan" && sex === "F" && age === "20s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ì˜ë£Œ/ê±´ê°•","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ë””ì €íŠ¸"];
        } else if (region === "Gwan" && sex === "M" && age === "30s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ìƒí™œì„œë¹„ìŠ¤","ì‹ì‚¬","ì˜ë£Œ/ê±´ê°•","ë””ì €íŠ¸"];
        } else if (region === "Gwan" && sex === "F" && age === "30s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ì˜ë£Œ/ê±´ê°•","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ë””ì €íŠ¸"];
        } else if (region === "Gwan" && sex === "M" && age === "40s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ìƒí™œì„œë¹„ìŠ¤","ì‹ì‚¬","ì˜ë£Œ/ê±´ê°•","ë””ì €íŠ¸"];
        } else if (region === "Gwan" && sex === "F" && age === "40s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ì˜ë£Œ/ê±´ê°•","ìƒí™œì„œë¹„ìŠ¤","ì‹ì‚¬","ë””ì €íŠ¸"];
        } else if (region === "Gwan" && sex === "M" && age === "50s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ìƒí™œì„œë¹„ìŠ¤","ì‹ì‚¬","ì˜ë£Œ/ê±´ê°•","ì—¬ê°€/ì˜¤ë½"];
        } else if (region === "Gwan" && sex === "F" && age === "50s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ì˜ë£Œ/ê±´ê°•","ìƒí™œì„œë¹„ìŠ¤","ì‹ì‚¬","ë””ì €íŠ¸"];
        } else if (region === "Gwan" && sex === "M" && age === "60s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ìƒí™œì„œë¹„ìŠ¤","ì‹ì‚¬","ì˜ë£Œ/ê±´ê°•","ì—¬ê°€/ì˜¤ë½"];
        } else if (region === "Gwan" && sex === "F" && age === "60s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ì˜ë£Œ/ê±´ê°•","ìƒí™œì„œë¹„ìŠ¤","ì‹ì‚¬","ë””ì €íŠ¸"];
        } else if (region === "Gwan" && sex === "M" && age === "70s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ìƒí™œì„œë¹„ìŠ¤","ì˜ë£Œ/ê±´ê°•","ì‹ì‚¬","ë””ì €íŠ¸"];
        } else if (region === "Gwan" && sex === "F" && age === "70s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ì˜ë£Œ/ê±´ê°•","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ë””ì €íŠ¸"];
        } else if (region === "Gwan" && sex === "M" && age === "80s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ì˜ë£Œ/ê±´ê°•","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ë””ì €íŠ¸"];
        } else if (region === "Gwan" && sex === "F" && age === "80s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ì˜ë£Œ/ê±´ê°•","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ë””ì €íŠ¸"];
        }
        else if (region === "Young" && sex === "M" && age === "20s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ì‹ì‚¬","ì˜ë£Œ/ê±´ê°•","ìƒí™œì„œë¹„ìŠ¤","ì „ììƒê±°ë˜"];
        } else if (region === "Young" && sex === "F" && age === "20s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ì‹ì‚¬","ì˜ë£Œ/ê±´ê°•","ì „ììƒê±°ë˜","ë””ì €íŠ¸"];
        } else if (region === "Young" && sex === "M" && age === "30s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ì‹ì‚¬","ì˜ë£Œ/ê±´ê°•","ì „ììƒê±°ë˜","ìƒí™œì„œë¹„ìŠ¤"];
        } else if (region === "Young" && sex === "F" && age === "30s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ì˜ë£Œ/ê±´ê°•","ì‹ì‚¬","ì „ììƒê±°ë˜","ìƒí™œì„œë¹„ìŠ¤"];
        } else if (region === "Young" && sex === "M" && age === "40s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ì˜ë£Œ/ê±´ê°•","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ì „ììƒê±°ë˜"];
        } else if (region === "Young" && sex === "F" && age === "40s") {
            recommendedItems = ["ì˜ë£Œ/ê±´ê°•","ì†Œë§¤/ìœ í†µ","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ì „ììƒê±°ë˜"];
        } else if (region === "Young" && sex === "M" && age === "50s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ì˜ë£Œ/ê±´ê°•","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ë””ì €íŠ¸"];
        } else if (region === "Young" && sex === "F" && age === "50s") {
            recommendedItems = ["ì˜ë£Œ/ê±´ê°•","ì†Œë§¤/ìœ í†µ","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ì „ììƒê±°ë˜"];
        } else if (region === "Young" && sex === "M" && age === "60s") {
            recommendedItems = ["ì˜ë£Œ/ê±´ê°•","ì†Œë§¤/ìœ í†µ","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ì „ììƒê±°ë˜"];
        } else if (region === "Young" && sex === "F" && age === "60s") {
            recommendedItems = ["ì˜ë£Œ/ê±´ê°•","ì†Œë§¤/ìœ í†µ","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ì „ììƒê±°ë˜"];
        } else if (region === "Young" && sex === "M" && age === "70s") {
            recommendedItems = ["ì˜ë£Œ/ê±´ê°•","ì†Œë§¤/ìœ í†µ","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ì „ììƒê±°ë˜"];
        } else if (region === "Young" && sex === "F" && age === "70s") {
            recommendedItems = ["ì˜ë£Œ/ê±´ê°•","ì†Œë§¤/ìœ í†µ","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ë””ì €íŠ¸"];
        } else if (region === "Young" && sex === "M" && age === "80s") {
            recommendedItems = ["ì˜ë£Œ/ê±´ê°•","ì†Œë§¤/ìœ í†µ","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ì „ììƒê±°ë˜"];
        } else if (region === "Young" && sex === "F" && age === "80s") {
            recommendedItems = ["ì˜ë£Œ/ê±´ê°•","ì†Œë§¤/ìœ í†µ","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ì „ììƒê±°ë˜"];
        }
        else if (region === "Jang" && sex === "M" && age === "20s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ì˜ë£Œ/ê±´ê°•","ì—¬ê°€/ì˜¤ë½"];
        } else if (region === "Jang" && sex === "F" && age === "20s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ìƒí™œì„œë¹„ìŠ¤","ì‹ì‚¬","ì˜ë£Œ/ê±´ê°•","ë””ì €íŠ¸"];
        } else if (region === "Jang" && sex === "M" && age === "30s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ìƒí™œì„œë¹„ìŠ¤","ì‹ì‚¬","ì˜ë£Œ/ê±´ê°•","ë””ì €íŠ¸"];
        } else if (region === "Jang" && sex === "F" && age === "30s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ìƒí™œì„œë¹„ìŠ¤","ì˜ë£Œ/ê±´ê°•","ì‹ì‚¬","ë””ì €íŠ¸"];
        } else if (region === "Jang" && sex === "M" && age === "40s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ìƒí™œì„œë¹„ìŠ¤","ì‹ì‚¬","ì˜ë£Œ/ê±´ê°•","ë””ì €íŠ¸"];
        } else if (region === "Jang" && sex === "F" && age === "40s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ìƒí™œì„œë¹„ìŠ¤","ì˜ë£Œ/ê±´ê°•","ì‹ì‚¬","ë””ì €íŠ¸"];
        } else if (region === "Jang" && sex === "M" && age === "50s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ìƒí™œì„œë¹„ìŠ¤","ì‹ì‚¬","ì˜ë£Œ/ê±´ê°•","ì—¬ê°€/ì˜¤ë½"];
        } else if (region === "Jang" && sex === "F" && age === "50s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ìƒí™œì„œë¹„ìŠ¤","ì˜ë£Œ/ê±´ê°•","ì‹ì‚¬","ë””ì €íŠ¸"];
        } else if (region === "Jang" && sex === "M" && age === "60s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ìƒí™œì„œë¹„ìŠ¤","ì‹ì‚¬","ì˜ë£Œ/ê±´ê°•","ì—¬ê°€/ì˜¤ë½"];
        } else if (region === "Jang" && sex === "F" && age === "60s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ì˜ë£Œ/ê±´ê°•","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ì „ììƒê±°ë˜"];
        } else if (region === "Jang" && sex === "M" && age === "70s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ì˜ë£Œ/ê±´ê°•","ìƒí™œì„œë¹„ìŠ¤","ì‹ì‚¬","ì—¬ê°€/ì˜¤ë½"];
        } else if (region === "Jang" && sex === "F" && age === "70s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ì˜ë£Œ/ê±´ê°•","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ì „ììƒê±°ë˜"];
        } else if (region === "Jang" && sex === "M" && age === "80s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ì˜ë£Œ/ê±´ê°•","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ì „ììƒê±°ë˜"];
        } else if (region === "Jang" && sex === "F" && age === "80s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ì˜ë£Œ/ê±´ê°•","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ë””ì €íŠ¸"];
        }
        else if (region === "Pal" && sex === "M" && age === "20s") {
            recommendedItems = ["ì‹ì‚¬","ì†Œë§¤/ìœ í†µ","ì˜ë£Œ/ê±´ê°•","ì—¬ê°€/ì˜¤ë½","ìƒí™œì„œë¹„ìŠ¤"];
        } else if (region === "Pal" && sex === "F" && age === "20s") {
            recommendedItems = ["ì‹ì‚¬","ì†Œë§¤/ìœ í†µ","ì˜ë£Œ/ê±´ê°•","ë””ì €íŠ¸","ìƒí™œì„œë¹„ìŠ¤"];
        } else if (region === "Pal" && sex === "M" && age === "30s") {
            recommendedItems = ["ì‹ì‚¬","ì†Œë§¤/ìœ í†µ","ì˜ë£Œ/ê±´ê°•","ìƒí™œì„œë¹„ìŠ¤","ì—¬ê°€/ì˜¤ë½"];
        } else if (region === "Pal" && sex === "F" && age === "30s") {
            recommendedItems = ["ì˜ë£Œ/ê±´ê°•","ì‹ì‚¬","ì†Œë§¤/ìœ í†µ","ìƒí™œì„œë¹„ìŠ¤","ë””ì €íŠ¸"];
        } else if (region === "Pal" && sex === "M" && age === "40s") {
            recommendedItems = ["ì‹ì‚¬","ì†Œë§¤/ìœ í†µ","ì˜ë£Œ/ê±´ê°•","ìƒí™œì„œë¹„ìŠ¤","ì—¬ê°€/ì˜¤ë½"];
        } else if (region === "Pal" && sex === "F" && age === "40s") {
            recommendedItems = ["ì˜ë£Œ/ê±´ê°•","ì†Œë§¤/ìœ í†µ","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ë””ì €íŠ¸"];
        } else if (region === "Pal" && sex === "M" && age === "50s") {
            recommendedItems = ["ì˜ë£Œ/ê±´ê°•","ì†Œë§¤/ìœ í†µ","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ì—¬ê°€/ì˜¤ë½"];
        } else if (region === "Pal" && sex === "F" && age === "50s") {
            recommendedItems = ["ì˜ë£Œ/ê±´ê°•","ì†Œë§¤/ìœ í†µ","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ë””ì €íŠ¸"];
        } else if (region === "Pal" && sex === "M" && age === "60s") {
            recommendedItems = ["ì˜ë£Œ/ê±´ê°•","ì†Œë§¤/ìœ í†µ","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ì—¬ê°€/ì˜¤ë½"];
        } else if (region === "Pal" && sex === "F" && age === "60s") {
            recommendedItems = ["ì†Œë§¤/ìœ í†µ","ì˜ë£Œ/ê±´ê°•","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ë””ì €íŠ¸"];
        } else if (region === "Pal" && sex === "M" && age === "70s") {
            recommendedItems = ["ì˜ë£Œ/ê±´ê°•","ì†Œë§¤/ìœ í†µ","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ë””ì €íŠ¸"];
        } else if (region === "Pal" && sex === "F" && age === "70s") {
            recommendedItems = ["ì˜ë£Œ/ê±´ê°•","ì†Œë§¤/ìœ í†µ","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ë””ì €íŠ¸"];
        } else if (region === "Pal" && sex === "M" && age === "80s") {
            recommendedItems = ["ì˜ë£Œ/ê±´ê°•","ì†Œë§¤/ìœ í†µ","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ë””ì €íŠ¸"];
        } else if (region === "Pal" && sex === "F" && age === "80s") {
            recommendedItems = ["ì˜ë£Œ/ê±´ê°•","ì†Œë§¤/ìœ í†µ","ì‹ì‚¬","ìƒí™œì„œë¹„ìŠ¤","ë””ì €íŠ¸"];
        }

        const allItems = ["ì†Œë§¤/ìœ í†µ","ìƒí™œì„œë¹„ìŠ¤","ì—¬ê°€/ì˜¤ë½","ì‹ì‚¬","ë””ì €íŠ¸","ì˜ë£Œ/ê±´ê°•","ê³µì—°/ì „ì‹œ","ì „ììƒê±°ë˜"];

        // --- ì¶”ì²œ ì—…ì¢… ì¹´ë“œ ---
        const recCard = document.createElement("div");
        recCard.className = "results-card";
        const recTitle = document.createElement("h3");
        recTitle.className = "category-title";
        recTitle.innerHTML = "ğŸ¯ ì¶”ì²œ ì—…ì¢… ì„ íƒ";
        recCard.appendChild(recTitle);

        const recGroup = document.createElement("div");
        recGroup.className = "checkbox-group";
        recGroup.style.gridTemplateColumns = "1fr";
        recommendedItems.forEach(item => {
            const label = document.createElement("label");
            const checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.name = "recommended";
            checkbox.value = item;
            const span = document.createElement("span");
            span.textContent = item;
            label.appendChild(checkbox);
            label.appendChild(span);
            recGroup.appendChild(label);
        });
        recCard.appendChild(recGroup);
        resultDiv.appendChild(recCard);

        // --- ì „ì²´ ì—…ì¢… ì¹´ë“œ ---
        const allCard = document.createElement("div");
        allCard.className = "results-card";
        const allTitle = document.createElement("h3");
        allTitle.className = "category-title";
        allTitle.innerHTML = "ğŸ“‹ ì „ì²´ ì—…ì¢… ì„ íƒ";
        allCard.appendChild(allTitle);

        const allGroup = document.createElement("div");
        allGroup.className = "checkbox-group";
        allItems.forEach(item => {
            const label = document.createElement("label");
            const checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.name = "allCategory";
            checkbox.value = item;
            const span = document.createElement("span");
            span.textContent = item;
            label.appendChild(checkbox);
            label.appendChild(span);
            allGroup.appendChild(label);
        });
        allCard.appendChild(allGroup);
        resultDiv.appendChild(allCard);

        // --- ì†Œë¶„ë¥˜ ìƒì„± ë²„íŠ¼ (ì•„ë˜ 'ì†Œë¶„ë¥˜ ê²€ìƒ‰' ë²„íŠ¼) ---
        const buttonContainer = document.createElement("div");
        buttonContainer.style.textAlign = "center";
        buttonContainer.style.marginTop = "2rem";
        const subBtn = document.createElement("button");
        subBtn.className = "action-button";
        subBtn.innerHTML = "ğŸ” ì†Œë¶„ë¥˜ ê²€ìƒ‰";
        // í´ë¦­í•˜ë©´ ì²´í¬ëœ ëŒ€ë¶„ë¥˜(ì¶”ì²œ + ì „ì²´)ë“¤ì„ ëª¨ì•„ì„œ ì†Œë¶„ë¥˜ ë Œë”
        subBtn.onclick = () => {
            const selectedRecommended = Array.from(document.querySelectorAll('input[name="recommended"]:checked')).map(el => el.value);
            const selectedAll = Array.from(document.querySelectorAll('input[name="allCategory"]:checked')).map(el => el.value);
            const selectedSet = Array.from(new Set([...selectedRecommended, ...selectedAll]));
            renderSubCategories(selectedSet);
        };
        buttonContainer.appendChild(subBtn);
        resultDiv.appendChild(buttonContainer);
    }

    // --- ì†Œë¶„ë¥˜ ë Œë” ë° "ì¹´ë“œ ê²€ìƒ‰" ë²„íŠ¼ ì¶”ê°€ ---
    function renderSubCategories(selectedCategories) {
        // ì œê±°: ê¸°ì¡´ ì†Œë¶„ë¥˜ ì»¨í…Œì´ë„ˆê°€ ìˆìœ¼ë©´ ì œê±°
        const existing = document.querySelector('.subcategory-container');
        if (existing) existing.remove();

        if (!selectedCategories || selectedCategories.length === 0) {
            // ì„ íƒëœ ëŒ€ë¶„ë¥˜ê°€ ì—†ìœ¼ë©´ ì•„ë¬´ê²ƒë„ í‘œì‹œí•˜ì§€ ì•ŠìŒ (ìš”ì²­ëŒ€ë¡œ ì•Œë¦¼ ì—†ìŒ)
            return;
        }

        const resultDiv = document.getElementById("resultContainer");
        const subContainer = document.createElement("div");
        subContainer.className = "results-card subcategory-container";
        subContainer.id = "subcategoryContainer";

        const subMainTitle = document.createElement("h3");
        subMainTitle.className = "category-title";
        subMainTitle.innerHTML = "ğŸ” ì†Œë¶„ë¥˜ ì„ íƒ";
        subContainer.appendChild(subMainTitle);

        selectedCategories.forEach(category => {
            if (!subCategoryMap[category]) return;
            const subGroup = document.createElement("div");
            subGroup.className = "subcategory-group";

            const groupTitle = document.createElement("div");
            groupTitle.className = "subcategory-title";
            groupTitle.textContent = category;
            subGroup.appendChild(groupTitle);

            const subItems = document.createElement("div");
            subItems.className = "subcategory-items";

            subCategoryMap[category].forEach(sub => {
                const label = document.createElement("label");
                const checkbox = document.createElement("input");
                checkbox.type = "checkbox";
                checkbox.name = "subcategory";
                checkbox.value = sub;
                const span = document.createElement("span");
                span.textContent = sub;
                label.appendChild(checkbox);
                label.appendChild(span);
                subItems.appendChild(label);
            });

            subGroup.appendChild(subItems);
            subContainer.appendChild(subGroup);
        });

        // ì¹´ë“œ ê²€ìƒ‰ ë²„íŠ¼ ì¶”ê°€ (ì†Œë¶„ë¥˜ ì„ íƒ í›„ í´ë¦­)
        const searchBtn = document.createElement("button");
        searchBtn.className = "action-button";
        searchBtn.innerText = "ğŸ’³ ì¹´ë“œ ê²€ìƒ‰";
        searchBtn.onclick = () => {
            // ì„ íƒí•œ ëŒ€ë¶„ë¥˜(ì¶”ì²œ/ì „ì²´)ì™€ ì†Œë¶„ë¥˜ë¥¼ ê°€ì ¸ì™€ì„œ ê²€ìƒ‰
            const bigSel = Array.from(document.querySelectorAll('input[name="recommended"]:checked, input[name="allCategory"]:checked')).map(el => el.value);
            const subSel = Array.from(document.querySelectorAll('input[name="subcategory"]:checked')).map(el => el.value);
            // ê²€ìƒ‰ ì‹¤í–‰
            runCardSearch(bigSel, subSel);
        };
        // ë²„íŠ¼ ì˜ì—­
        const btnWrap = document.createElement("div");
        btnWrap.style.textAlign = "center";
        btnWrap.style.marginTop = "1rem";
        btnWrap.appendChild(searchBtn);
        subContainer.appendChild(btnWrap);

        resultDiv.appendChild(subContainer);
    }

    // --- ì¹´ë“œ ê²€ìƒ‰ ì‹¤ì œ ë¡œì§: CSV ë°ì´í„°ì—ì„œ ëŒ€ë¶„ë¥˜ OR ì†Œë¶„ë¥˜ íƒœê·¸ê°€ ë§ëŠ” ì¹´ë“œ í•„í„° ---
    function runCardSearch(selectedBigCategories, selectedSubCategories) {
        // if nothing selected -> do nothing (ìš”ì²­ëŒ€ë¡œ alert ì œê±°)
        if ((!selectedBigCategories || selectedBigCategories.length === 0) && (!selectedSubCategories || selectedSubCategories.length === 0)) {
            // ì•„ë¬´ ê²ƒë„ í•˜ì§€ ì•ŠìŒ (ê²°ê³¼ ì˜ì—­ í´ë¦¬ì–´)
            const resArea = document.getElementById("cardResultsArea");
            if (resArea) resArea.remove();
            return;
        }

        // helper: parse tag-field (ëŒ€ë¶„ë¥˜íƒœê·¸/ì†Œë¶„ë¥˜íƒœê·¸) which stored as "['a','b']"
        function parseTagField(field) {
            if (!field) return [];
            // try JSON.parse after replacing single-quotes with double-quotes
            try {
                const normalized = field.replace(/'/g, '"');
                const arr = JSON.parse(normalized);
                if (Array.isArray(arr)) return arr;
            } catch (e) {
                // fallback: split on comma
                return field.replace(/^\[|\]$/g, '').split(',').map(s => s.replace(/['"]/g, '').trim()).filter(Boolean);
            }
            return [];
        }

        const results = cardData.filter(row => {
            // some CSV rows may be empty objects; guard
            if (!row || Object.keys(row).length === 0) return false;
            const bigTags = parseTagField(row['ëŒ€ë¶„ë¥˜íƒœê·¸']);
            const smallTags = parseTagField(row['ì†Œë¶„ë¥˜íƒœê·¸']);
            // match if ANY selected big category present in bigTags OR ANY selected sub present in smallTags
            const bigMatch = selectedBigCategories && selectedBigCategories.some(b => bigTags.includes(b));
            const subMatch = selectedSubCategories && selectedSubCategories.some(s => smallTags.includes(s));
            return bigMatch || subMatch;
        });

        displayCardResults(results);
    }

    // --- ì¹´ë“œ ê²°ê³¼ ë Œë” ---
    function displayCardResults(cards) {
        // remove previous result area if exists
        const prevArea = document.getElementById("cardResultsArea");
        if (prevArea) prevArea.remove();

        const resultDiv = document.getElementById("resultContainer");
        const area = document.createElement("div");
        area.id = "cardResultsArea";
        area.className = "results-card";

        const title = document.createElement("h3");
        title.className = "category-title";
        title.textContent = `ğŸ’³ ê²€ìƒ‰ ê²°ê³¼ (${cards.length})`;
        area.appendChild(title);

        const listWrap = document.createElement("div");
        listWrap.style.marginTop = "1rem";

        if (!cards || cards.length === 0) {
            const p = document.createElement("p");
            p.textContent = "ì¡°ê±´ì— ë§ëŠ” ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤.";
            listWrap.appendChild(p);
        } else {
            cards.forEach(c => {
                // sanitize fields (some CSV rows may include trailing empty fields)
                const imgUrl = c['ì´ë¯¸ì§€ URL'] || c['ì´ë¯¸ì§€URL'] || "";
                const name = c['ì¹´ë“œëª…'] || "-";
                const chk = c['ì²´í¬/ì‹ ìš©'] || "-";
                const benefit = c['í†µí•©í˜œíƒ'] || "-";
                const bigTags = c['ëŒ€ë¶„ë¥˜íƒœê·¸'] || "";
                const smallTags = c['ì†Œë¶„ë¥˜íƒœê·¸'] || "";
                const detailLink = c['ì¹´ë“œ ë””í…Œì¼ ë§í¬'] || c['ì¹´ë“œë””í…Œì¼ë§í¬'] || "#";

                const cardDiv = document.createElement("div");
                cardDiv.className = "card-result";

                const img = document.createElement("img");
                img.src = imgUrl;
                img.alt = name;
                img.onerror = function(){ this.style.opacity = .5; this.style.filter = "grayscale(60%)"; };

                const info = document.createElement("div");
                info.style.maxWidth = "760px";
                info.innerHTML = `
                    <h3 style="margin:0 0 6px 0;">${escapeHtml(name)} <small style="color:#666; font-weight:600;">(${escapeHtml(chk)})</small></h3>
                    <p style="margin:6px 0;"><strong>í˜œíƒ:</strong> ${escapeHtml(benefit)}</p>
                    <p style="margin:6px 0;"><strong>ì—…ì¢…:</strong> ${escapeHtml(bigTags)} / ${escapeHtml(smallTags)}</p>
                    <p style="margin:6px 0;"><a href="${escapeAttr(detailLink)}" target="_blank" rel="noopener">ìì„¸íˆ ë³´ê¸°</a></p>
                `;

                cardDiv.appendChild(img);
                cardDiv.appendChild(info);
                listWrap.appendChild(cardDiv);
            });
        }

        area.appendChild(listWrap);
        resultDiv.appendChild(area);

        // scroll to results
        area.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    // ì†Œê·œëª¨ í—¬í¼: XSS ëŒ€ë¹„(ê°„ë‹¨)
    function escapeHtml(str) {
        if (typeof str !== "string") return str;
        return str.replace(/[&<>"']/g, (m) => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }
    function escapeAttr(s){ return escapeHtml(String(s || "")); }

    </script>
</body>
</html>
